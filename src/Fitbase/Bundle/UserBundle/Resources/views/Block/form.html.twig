{% use "form_div_layout.html.twig" %}

{% block form_row -%}
    <div class="row">
        <div class="col-md-12">
            {{- form_label(form) -}}
            {{- form_errors(form) -}}
            {{- form_widget(form) -}}

            {% if form.vars.submitted is defined and form.vars.submitted %}
                <script type="text/javascript">
                    $(function () {
                        var container = $(document);
                        container.trigger({
                            type: 'form',
                            selector: 'form[name={{ id }}]'
                        });
                    });
                </script>
            {% endif %}

        </div>
    </div>
{%- endblock form_row %}

    {% block button_row -%}
        <div class="row" style="padding-top: 15px;">
            <div class="col-md-12">
                {{- form_widget(form) -}}
            </div>
        </div>
    {%- endblock button_row %}


    {% block user_focus_priority_categories_widget %}
        {% spaceless %}
            <script type="text/javascript">
                $(function () {
                    var container = $(document);
                    container.find(".sortable_container").sortable({
                        update: function (event, ui) {
                            container.find('.sortable_item').each(function (index, element) {
                                var container = $(element).children('div');
                                container.trigger({
                                    type: 'position_update',
                                    index: index
                                });
                            });
                        }
                    });
                });
            </script>
            {{ form_errors(form) }}
            <div {{ block('widget_container_attributes') }} class="sortable_container">
                {%- for child in form %}
                    <div class="col-md-12 ui-state-default sortable_item" style="background: #f6f6f6 !important;">
                        {{- form_widget(child, { 'index': loop.index }) -}}
                    </div>
                {% endfor -%}
            </div>
        {% endspaceless %}
    {% endblock user_focus_priority_categories_widget %}


    {% block user_focus_priority_category_widget %}
        {% spaceless %}
            <style>
                h4.category-focus {
                    margin-top: 8px !important;
                }
            </style>

            <script type="text/javascript">
                $(function () {
                    var global = $(document);
                    var container = $("#{{ id }}");
                    container.bind('position_update', function (event) {
                        global.find('h4.{{ id }}').html((event.index + 1));
                        container.find('input.priority').val(event.index);
                    });
                });
            </script>

            {% if form.vars is defined %}
                {% if form.vars.value is defined %}
                    {% set category = form.vars.value.category %}

                    <div class="row" style="color: #333">
                        {% if index is defined %}
                            <div class="col-md-1" style="padding-top: 15px;">
                                <h4 class="category-focus {{ id }}">{{ index }}</h4>
                            </div>
                        {% endif %}

                        {% if category.media is defined %}
                            <div class="col-md-2" style="padding-top: 2px; padding-bottom: 2px; ">
                                {% thumbnail category.media, 'preview' with { 'height': 56, 'width': null } %}
                            </div>
                        {% endif %}

                        <div class="col-md-9">
                            <h4 class="category-focus">{{ category.name }}
                                <p><sub>{{ category.description }}</sub></p>
                            </h4>
                        </div>
                    </div>

                {% endif %}
            {% endif %}
            {{ form_errors(form) }}
            {{ form_widget(form) }}

            {% if form.vars.submitted is defined and form.vars.submitted %}
                <script type="text/javascript">
                    $(function () {
                        var container = $(document);
                        container.trigger({
                            type: 'form',
                            selector: 'form[name={{ id }}]'
                        });
                    });
                </script>
            {% endif %}

        {% endspaceless %}
    {% endblock user_focus_priority_category_widget %}